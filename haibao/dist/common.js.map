{"version":3,"file":"common.js","sources":["webpack:///./src/libs/ajax.js","webpack:///./src/libs/globalData.js","webpack:///./src/libs/mixin.js"],"sourcesContent":["import Taro from '@tarojs/taro';\nimport { createCache } from \"./globalData\";\nconst globalData = createCache();\n// c.set(\"test\", 100);\n// console.log(c.get(\"test\"));\n\nconst DOMAIN = 'https://campaign5.method-ad.cn/hypertherm/';\nexport function getOpenid() {\n    return new Promise((resolve, reject) => {\n        var openid = globalData.get(\"openid\");\n        if(openid){\n            resolve(openid);\n        }else{\n            wx.login({\n              success (res) {\n                if (res.code) {\n                  Taro.request({\n                        url: DOMAIN + 'xcx_request.php?rndv='+Math.random() + '&act=getOpenid',\n                        data: {\n                            code:res.code\n                        },\n                        method:'post',\n                        header:{\n                            'Content-Type':'application/x-www-form-urlencoded'\n                        },\n                        success (res) {\n                            if(res.data.status == 1){\n                                globalData.set('openid',res.data.openid);\n                                resolve(res.data.openid);\n                            }\n                        },\n                        fail(e){\n                            reject(e);\n                        }\n                    });\n                } else {\n                  console.log('登录失败！' + res.errMsg)\n                }\n              }\n            });\n        }\n    })\n}\nexport function ajax(options = {}) {\n    return new Promise((resolve, reject) => {\n        getOpenid().then(openid=>{\n            let obj = Object.assign({}, options.data || {}, {openid:openid});\n            Taro.request({\n                url: DOMAIN + options.url + '?rndv='+Math.random() + '&act='+obj.act,\n                data: {...obj,act:options.data.act2 || '' },\n                method:'post',\n                header:{\n                    'Content-Type':'application/x-www-form-urlencoded'\n                },\n                success (res) {\n                    resolve(res.data);\n                },\n                fail(e){\n                    reject(e);\n                }\n            });\n        })\n    })\n};\n","export function createCache() {\n    const globalData = {\n      \n    };\n    return {\n      set(key, val) {\n        globalData[key] = val;\n        wx.setStorageSync(key, val);\n      },\n      get(key) {\n        return wx.getStorageSync(key) || '';\n      }\n    }\n  }\n  ","import { ajax } from \"./ajax\";\n\nexport default {\n  data() {\n    return {\n      containerTop: 0\n    }\n  },\n  beforeDestroy(){\n    this.$store.commit('set_liveLeadsModel');\n    this.$store.commit('set_downloadLeadsModel');\n    this.$store.commit('set_consultLeadsModel');\n  },\n  created() {\n    let menuButtonObject = wx.getMenuButtonBoundingClientRect();\n    this.containerTop = menuButtonObject.height + menuButtonObject.top + 10;\n  },\n  methods: {\n    getOpenId(callback) {\n        let data = {\n          openid: this.openid\n        }\n\n        callback(data)\n    },\n    session(callback) {\n        let data = {\n          sessionFrom: this.userInfo\n        }\n        callback(data)\n    },\n    viewVideo(item) {\n      this.viewVideoSrc = item.video_filename;\n    },\n    toViewPdf(item, tp = 100) {\n      wx.navigateTo({ url: '/pages/pdf/index?src=' + item.pdf_filename + '&title=' + item.title+'&share_picture='+item.pdf_share_picture });\n\n      ajax({\n        url: 'xcx_request.php',\n        data: {\n          act: 'set_File_History',\n          act2: 'read',\n          tp: this.$store.state.category,\n          tp_value: item.class_id || item.tech_detail_id || item.product_id,\n          file_tp: 'pdf',\n          watch_time: 0,\n        },\n      });\n      // wx.downloadFile({\n      //   // 示例 url，并非真实存在\n      //   url:item.pdf_filename,\n      //   success: function (res) {\n      //     const filePath = res.tempFilePath\n      //     wx.openDocument({\n      //       filePath: filePath,\n      //       success: function (res) {\n      //         console.log('打开文档成功')\n      //       }\n      //     })\n      //   }\n      // })\n    },\n    toViewVideo(item, tp = 100) {\n      console.log(item);\n      if(item.category_id == 1){\n        this.$store.commit('set_category',310);\n      }else{\n        this.$store.commit('set_category',320);\n      }\n\n      if(item.appointment_isform == 0 && item.category_id==2){\n        this.$store.commit('set_liveLeadsModel',true);\n        item.tp = tp;\n        this.$store.commit('set_leadsItem',item);\n      }else{\n        wx.navigateTo({ url: '/pages/server/video?title=' + item.title + '&video_filename=' + item.video_filename + '&video_picture=' + item.video_picture + '&share_img=' + item.video_share_picture + '&id=' + (item.class_id || item.tech_detail_id) });\n      }\n    },\n    downloadPdf(item, tp = 100) {\n      console.log(item);\n      this.$store.commit('set_lastTp',2);\n      if(item.pdf_isform > 0){\n        wx.showToast({\n            title: '资料已发送到您的邮箱',\n            icon: 'none',\n            duration: 2000,\n        });\n\n        ajax({\n          url: 'xcx_request.php',\n          data: {\n            act: 'set_File_History',\n            act2: 'download',\n            tp: this.$store.state.category,\n            tp_value: item.class_id || item.tech_detail_id,\n            file_tp: 'pdf',\n            watch_time: 0,\n          },\n        });\n      }else{\n        this.$store.commit('set_downloadLeadsModel',true);\n        item.tp = tp;\n        this.$store.commit('set_leadsItem',item);\n      }\n      // wx.showLoading({\n      //   title: '加载中...',\n      // })\n      // const fileExtName = \".pdf\";\n      // const randfile = new Date().getTime() + fileExtName;\n      // const newPath = `${wx.env.USER_DATA_PATH}/${randfile}`;\n      // wx.downloadFile({\n      //   url: item.pdf_filename,\n      //   filePath: newPath,\n      //   success: res => {\n      //     let filePath = res.tempFilePath;\n      //     wx.openDocument({\n      //       filePath: newPath,\n      //       showMenu: true,\n      //       fileType: 'pdf',\n      //       success: function(res) {}\n      //     })\n      //     wx.hideLoading();\n      //   }\n      // });\n    },\n    downloadVideo(item, tp = 100) {\n      this.$store.commit('set_lastTp',2);\n      wx.showLoading({\n        title: '加载中...',\n      })\n      wx.downloadFile({\n        url: item.video_filename,\n        success: res => {\n          let filePath = res.tempFilePath;\n          console.log(res);\n          wx.saveVideoToPhotosAlbum({\n            filePath: filePath,\n            success: file => {\n              wx.showToast({\n                title: '已保存到相册',\n                icon: 'none',\n                duration: 2000,\n              })\n              wx.hideLoading();\n            },\n            fail: err => {\n              console.log(err)\n              wx.showToast({\n                title: '获取权限失败，将无法保存到相册哦~',\n                icon: 'none',\n                duration: 2000,\n              })\n              wx.hideLoading();\n            }\n          })\n        }\n      });\n\n\n      ajax({\n        url: 'xcx_request.php',\n        data: {\n          act: 'set_File_History',\n          act2: 'download',\n          tp: this.$store.state.category,\n          tp_value: item.class_id || item.tech_detail_id,\n          file_tp: 'video',\n          watch_time: 0,\n        },\n      });\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBA;AAmBA;AACA;AACA;AACA;AAzBA;AA2BA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAZA;AAcA;AACA;AACA;AAAA;;;;;;;;;;;;;AC/DA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;;;;;;;;;;;;;ACbA;AAAA;AAEA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAWA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAlBA;AAoBA;AAzBA;AA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAFA;AAWA;AAzJA;AAfA;;;;A","sourceRoot":""}